/*
* Copyright (C) 2022 Hypnotic Development
*
* This program is free software: you can redistribute it and/or modify
* it under the terms of the GNU General Public License as published by
* the Free Software Foundation, either version 3 of the License, or
* any later version.
*
* This program is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU General Public License for more details.
*
* You should have received a copy of the GNU General Public License
* along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
package dev.hypnotic.module.exploit;

import dev.hypnotic.event.EventTarget;
import dev.hypnotic.event.events.EventReceivePacket;
import dev.hypnotic.event.events.EventSendPacket;
import dev.hypnotic.mixin.PlayerInputC2SPacketAccessor;
import dev.hypnotic.module.Category;
import dev.hypnotic.module.Mod;
import dev.hypnotic.settings.settingtypes.ModeSetting;
import dev.hypnotic.utils.ColorUtils;
import net.minecraft.network.packet.c2s.play.PlayerActionC2SPacket;
import net.minecraft.network.packet.c2s.play.PlayerInputC2SPacket;
import net.minecraft.network.packet.c2s.play.PlayerInteractEntityC2SPacket;
import net.minecraft.network.packet.s2c.play.KeepAliveS2CPacket;
import net.minecraft.network.packet.s2c.play.PlayerPositionLookS2CPacket;

public class Disabler extends Mod {
	
	public ModeSetting mode = new ModeSetting("Mode", "Position Packet", "Position Packet", "Verus");
	
    public Disabler() {
        super("Disabler", "Disables crappy anticheats", Category.EXPLOIT);
        addSettings(mode);
    }

    @EventTarget
    public void onReceivePacket(EventReceivePacket event) {
    	this.setDisplayName("Disabler " + ColorUtils.gray + mode.getSelected());
        if (mc.player != null && mc.world != null && mc.player.age <= 40) {
            if (event.getPacket() instanceof PlayerPositionLookS2CPacket && mode.is("Position Packet")) {
                event.setCancelled(true);
            } else if (mode.is("Verus")) {
//            	if (event.getPacket() instanceof S32PacketConfirmTransaction) {
//        			event.setCancelled(true);
//        		}
        		if (event.getPacket() instanceof KeepAliveS2CPacket) {
        			event.setCancelled(true);
        		}
            }
        }
    }
    
    @EventTarget
    public void onSendPacket(EventSendPacket event) {
    	if (mode.is("Verus")) {
            if (event.getPacket() instanceof PlayerInteractEntityC2SPacket) {
                event.setCancelled(true);
            }
            if (event.getPacket() instanceof PlayerActionC2SPacket) {
            	mc.player.networkHandler.sendPacket(new PlayerInputC2SPacket(0, 0, false, false));
            }
            if (event.getPacket() instanceof PlayerInputC2SPacket) {
                final PlayerInputC2SPacket packet = (PlayerInputC2SPacket)event.getPacket();
//                mc.player.networkHandler.sendPacket(new PlayerInputC2SPacket(Float.POSITIVE_INFINITY, Float.POSITIVE_INFINITY, mc.player.age % 2 == 0, mc.player.age % 2 != 0));
                ((PlayerInputC2SPacketAccessor)packet).setForward(Float.POSITIVE_INFINITY);
                ((PlayerInputC2SPacketAccessor)packet).setSideways(Float.POSITIVE_INFINITY);
                ((PlayerInputC2SPacketAccessor)packet).setJumping(mc.player.age % 2 == 0);
                ((PlayerInputC2SPacketAccessor)packet).setSneaking(mc.player.age % 2 != 0);
            }
    	}
    }
}
